<!--
    Singolo articolo nella lista.

    Partial template usato da:
    - Lista articoli (list.html)
    - Risposta HTMX dopo creazione/modifica

    Variabili richieste:
    - article: oggetto Article dal database
-->
<article class="article-card" id="article-{{ article.id }}">
    <div class="article-info">
        <h3 class="article-title">{{ article.titolo }}</h3>

        {% if article.sottotitolo %}
        <p class="article-subtitle">{{ article.sottotitolo }}</p>
        {% endif %}

        <div class="article-meta">
            {% if article.autore %}
            <span class="meta-author">
                <strong>{{ article.nome_autore or '' }}</strong>
                {{ article.autore }}
            </span>
            {% endif %}

            <span class="meta-date">
                {{ article.created_at.strftime('%d/%m/%Y') }}
            </span>

            <!-- Badge numeri GEKO assegnati -->
            {% if article.magazines %}
                {% for mag in article.magazines %}
                <span class="badge badge-primary" title="Pubblicato in GEKO {{ mag.numero }}">
                    GEKO {{ mag.numero }}
                </span>
                {% endfor %}
            {% else %}
            <span class="badge badge-outline" title="Articolo non ancora assegnato a un numero">
                ‚ö†Ô∏è Da assegnare
            </span>
            {% endif %}

            <!-- Badge sommario AI -->
            {% if article.sommario_llm %}
            <span class="badge badge-success" title="{{ article.sommario_llm }}">
                ‚úì Sommario AI
            </span>
            {% else %}
            <span class="badge badge-warning">
                Senza sommario
            </span>
            {% endif %}
        </div>
    </div>

    <div class="article-actions">
        <!-- Assegna a numero GEKO -->
        <button
            class="btn btn-small btn-outline"
            hx-get="/articles/{{ article.id }}/assign"
            hx-target="#assign-modal-content"
            hx-swap="innerHTML"
            onclick="document.getElementById('assign-modal').showModal()"
            title="Assegna a numero GEKO"
        >
            üìé Assegna
        </button>

        <!-- Genera/Rigenera sommario AI -->
        {% if article.sommario_llm %}
        <button
            class="btn btn-small btn-outline"
            hx-post="/articles/{{ article.id }}/summary"
            hx-target="#article-{{ article.id }}"
            hx-swap="outerHTML"
            hx-indicator="#loading-{{ article.id }}"
            hx-confirm="Vuoi rigenerare il sommario AI? Il sommario attuale verr√† sostituito."
            title="Rigenera sommario AI"
        >
            üîÑ Rigenera
        </button>
        {% else %}
        <button
            class="btn btn-small btn-outline"
            hx-post="/articles/{{ article.id }}/summary"
            hx-target="#article-{{ article.id }}"
            hx-swap="outerHTML"
            hx-indicator="#loading-{{ article.id }}"
            title="Genera sommario con AI"
        >
            ü§ñ Genera sommario
        </button>
        {% endif %}
        <span id="loading-{{ article.id }}" class="htmx-indicator">Generando...</span>

        <!-- Modifica -->
        <a href="/articles/{{ article.id }}/edit" class="btn btn-small">
            ‚úèÔ∏è Modifica
        </a>

        <!-- Elimina -->
        <button
            class="btn btn-small btn-danger"
            hx-delete="/articles/{{ article.id }}"
            hx-target="#article-{{ article.id }}"
            hx-swap="outerHTML"
            hx-confirm="Sei sicuro di voler eliminare questo articolo?"
        >
            üóëÔ∏è
        </button>
    </div>
</article>
